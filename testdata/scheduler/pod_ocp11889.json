{
   "kind":"Template",
   "apiVersion":"v1",
   "metadata":{
      "name":"ruby-helloworld-sample"
   },
   "objects":[
      {
         "kind":"Service",
         "apiVersion":"v1",
         "metadata":{
            "name":"database",
            "creationTimestamp":null
         },
         "spec":{
            "ports":[
               {
                  "name":"db",
                  "protocol":"TCP",
                  "port":5434,
                  "targetPort":3306,
                  "nodePort":0
               }
            ],
            "selector":{
               "name":"database"
            },
            "portalIP":"",
            "type":"ClusterIP",
            "sessionAffinity":"None"
         },
         "status":{
            "loadBalancer":{

            }
         }
      },
      {
         "kind":"DeploymentConfig",
         "apiVersion":"v1",
         "metadata":{
            "name":"database",
            "creationTimestamp":null
         },
         "spec":{
            "strategy":{
               "type":"Recreate",
               "recreateParams":{
                  "pre":{
                     "failurePolicy":"Abort",
                     "execNewPod":{
                        "command":[
                           "/bin/true"
                        ],
                        "env":[
                           {
                              "name":"CUSTOM_VAR1",
                              "value":"custom_value1"
                           }
                        ],
                        "containerName":"ruby-helloworld-database"
                     }
                  },
                  "post":{
                     "failurePolicy":"Ignore",
                     "execNewPod":{
                        "command":[
                           "/bin/false"
                        ],
                        "env":[
                           {
                              "name":"CUSTOM_VAR2",
                              "value":"custom_value2"
                           }
                        ],
                        "containerName":"ruby-helloworld-database"
                     }
                  }
               },
               "resources":{

               }
            },
            "triggers":[
               {
                  "type":"ConfigChange"
               }
            ],
            "replicas":3,
            "selector":{
               "name":"database"
            },
            "template":{
               "metadata":{
                  "creationTimestamp":null,
                  "labels":{
                     "name":"database"
                  }
               },
               "spec":{
                  "containers":[
                     {
                        "name":"ruby-helloworld-database",
                        "image":"openshift/mysql-55-centos7:latest",
                        "ports":[
                           {
                              "containerPort":3306,
                              "protocol":"TCP"
                           }
                        ],
                        "env":[
                           {
                              "name":"MYSQL_USER",
                              "value":"${MYSQL_USER}"
                           },
                           {
                              "name":"MYSQL_PASSWORD",
                              "value":"${MYSQL_PASSWORD}"
                           },
                           {
                              "name":"MYSQL_DATABASE",
                              "value":"${MYSQL_DATABASE}"
                           }
                        ],
                        "resources":{

                        },
                        "terminationMessagePath":"/dev/termination-log",
                        "imagePullPolicy":"Always",
                        "capabilities":{

                        },
                        "securityContext":{
                           "capabilities":{

                           },
                           "privileged":false
                        }
                     }
                  ],
                  "restartPolicy":"Always",
                  "dnsPolicy":"ClusterFirst",
                  "serviceAccount":""
               }
            }
         },
         "status":{

         }
      }
   ],
   "parameters":[
      {
         "name":"ADMIN_USERNAME",
         "description":"administrator username",
         "generate":"expression",
         "from":"admin[A-Z0-9]{3}"
      },
      {
         "name":"ADMIN_PASSWORD",
         "description":"administrator password",
         "generate":"expression",
         "from":"[a-zA-Z0-9]{8}"
      },
      {
         "name":"MYSQL_USER",
         "description":"database username",
         "generate":"expression",
         "from":"user[A-Z0-9]{3}"
      },
      {
         "name":"MYSQL_PASSWORD",
         "description":"database password",
         "generate":"expression",
         "from":"[a-zA-Z0-9]{8}"
      },
      {
         "name":"MYSQL_DATABASE",
         "description":"database name",
         "value":"root"
      }
   ],
   "labels":{
      "template":"application-template-stibuild"
   }
}
